<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Live Database</title>

  <!-- Bootstrap for Styling -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">

  <style>
    body { background: #f8f9fa; }
    h2 { margin: 20px 0; }
    .filter-section {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }
    .dataTables_wrapper .dt-buttons {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<div class="container mt-4">
  <h2 class="text-center">Admin Dashboard - Live Data</h2>

  <!-- Filters -->
  <div class="filter-section">
    <select id="filterWard" class="form-select" style="width:200px;">
      <option value="">Filter by Ward</option>
    </select>
    <select id="filterPolling" class="form-select" style="width:200px;">
      <option value="">Filter by Polling Unit</option>
    </select>
    <button id="resetFilters" class="btn btn-secondary">Reset Filters</button>
  </div>

  <!-- Data Table -->
  <div class="table-responsive">
    <table id="dataTable" class="display nowrap table table-bordered" style="width:100%">
      <thead>
        <tr>
          <th>Full Name</th>
          <th>Phone Number</th>
          <th>Gender</th>
          <th>State</th>
          <th>LGA</th>
          <th>Ward</th>
          <th>Polling Unit</th>
        <th>VIN</th>
            <th>Member ID</th>
        </tr>
      </thead>
      <tbody>
        <!-- Data from SheetDB will load here -->
      </tbody>
    </table>
  </div>
</div>

<!-- JS Libraries -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>

<script>
$(document).ready(function () {
    const sheetDBUrl = "YOUR_SHEETDB_API_URL"; // <-- Replace with your SheetDB API URL

    let table = $('#dataTable').DataTable({
        dom: 'Bfrtip',
        buttons: ['excelHtml5', 'pdfHtml5', 'print'],
        responsive: true
    });

    function loadData() {
        $.getJSON(sheetDBUrl, function (data) {
            table.clear();

            let wards = new Set();
            let pollingUnits = new Set();

            data.forEach(row => {
                table.row.add([
                    row.fullName || '',
                    row.phoneNumber || '',
                    row.gender || '',
                    row.state || '',
                    row.lga || '',
                    row.ward || '',
                    row.pollingUnit || '',
                    row.vin || '',
                    row.memberId || ''
                ]);

                if (row.ward) wards.add(row.ward);
                if (row.pollingUnit) pollingUnits.add(row.pollingUnit);
            });

            // Populate filters
            $('#filterWard').empty().append('<option value="">Filter by Ward</option>');
            $('#filterPolling').empty().append('<option value="">Filter by Polling Unit</option>');

            wards.forEach(w => $('#filterWard').append(`<option value="${w}">${w}</option>`));
            pollingUnits.forEach(p => $('#filterPolling').append(`<option value="${p}">${p}</option>`));

            table.draw();
        });
    }

    // Load data initially
    loadData();

    // Auto refresh every 10 seconds
    setInterval(loadData, 10000);

    // Filter functionality
    $('#filterWard').on('change', function () {
        table.column(5).search(this.value).draw();
    });

    $('#filterPolling').on('change', function () {
        table.column(6).search(this.value).draw();
    });

    $('#resetFilters').on('click', function () {
        $('#filterWard').val('');
        $('#filterPolling').val('');
        table.search('').columns().search('').draw();
    });
});
</script>
</body>
</html>
